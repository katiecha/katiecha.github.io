YUI.add("flickr-photosets-removePhoto-deletor",(function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:function(o,s){var l={full_response:1},i=[],u=o.isMultiplePhotos?"photo_ids":"photo_id",r=o.photoID.split(",").length;return l[u]=o.photoID,l.photoset_id=o.setID,o.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=o.userId),i=[s.callAPI("flickr.photosets.removePhoto",l),s.getModel("set-models",o.setID),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")||o.includeHiddenSets?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),e.Promise.all(i).then((function(e){var t,s=e[0],l=e[1],i=e[2],u=e[3],d=e[4];if("ok"===s.stat)return d.exists(o.photoID)&&d.getValue(o.photoID,"contexts").getFromListByID(o.setID)&&(d.setValue(o.photoID,"totalSets",d.getValue(o.photoID,"totalSets")-r),d.getValue(o.photoID,"contexts").removeFromList(o.setID)),u.exists(o.photoID)&&u.getValue(o.photoID,"sets").getFromListByID(o.setID)&&(u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")-r),u.getValue(o.photoID,"sets").removeFromList(o.setID)),l&&(o.isMultiplePhotos?l&&o.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")-o.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")-o.numberOfVideosSelected)):(t=e[5],l.hasPhoto(t.getValue("id"))&&l.removePhoto(t),t.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-r):l.setValue("photoCount",l.getValue("photoCount")-r)),l.getValue("totalCount")<1&&!o.includeHiddenSets)?(i.getValue("albumsList").remove(o.setID),l.registry.remove(o.setID),null):l}),e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("set-models",(function(e,t){var o=require("hermes-core/flog")(t);function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,o){return e.ModelCreators["flickr-photosets-create"].run(t,o)},createHidden:function(t,o){return e.ModelCreators["flickr-photosets-createHidden"].run(t,o)},addPhoto:function(t,o){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,o)},removePhoto:function(t,o){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,o)},update:function(t,o){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:t,title:o.title?o.title.newVal:this.getValue(t,"title"),description:o.description?o.description.newVal:this.getValue(t,"description")},this.appContext)},setPrimaryPhoto:function(t,o){return e.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(t,o)},delete:function(t){"string"==typeof t&&(t={setID:t});return e.ModelDeletors["flickr-photosets-delete-deletor"].run(t,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(t,r,i){o.info("Using `getSizeToFit` is deprecated. See model comments for more details.");var n=e.PhotoModelHelper.getSizeToFit(t,r,e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return n&&(n.url=n.src),n},getLargestPrimaryPhotoSize:function(t,o){return e.PhotoModelHelper.getLargestSize(t,o)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},publicPhotosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"totalCount"),i="";return 0===(t-=o)&&0===o?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),0===r?i=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===r?i=this.intlMessage({intlName:"models.ONE_ITEM"}):r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:r})),i}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r="";return 0===t&&0===o?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"owner"),i="";return t&&!o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(o,10)}):t&&o&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:r.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(o,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(t){var o=e.PhotoModelHelper.getSizeToFit(t,{height:75,width:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return o?o.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),o=this.getValue(e,"isSharedEntity"),r=this.getValue(e,"normalizedId");return t&&!0===o?"/photos/"+t.getValue("pathAlias")+"/shares/"+r:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+r:void 0}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isSharedEntity:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canShare:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return this.getValue(e,"isSharedEntity")?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,o){var r=e;return t&&(r+="-"+t),o&&(t||(r+="-dateposted"),r+="-"+o),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],optionalRequires:["hermes-core"],langBundles:["models","shared-entity"]});YUI.add("flickr-photos-getAllContexts-fetcher",(function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:function(o,s){var l=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(o.scrappy=!0),e.Promise.all([s.callAPI("flickr.photos.getAllContexts",this._processParams(o),!0),s.getModelRegistry("person-models"),s.getModelRegistry("photo-contexts-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("gallery-models"),s.getModelRegistry("group-pool-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-groups-models"),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-galleries-models"),s.getModelRegistry("group-models")]).then((function(e){return l._processResponse(e,o)}),e.FetcherErrorLogger(t))},_processParams:function(t){var o;return o={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+","+e.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"},t.scrappy&&(o.get_all_galleries=1,o.no_faves_context=1,o.per_type_limit=6,o.get_totals=1,o.sort="date-desc"),o},_processResponse:function(t,o){var s,l,r=t[0],a=t[1],p=t[2],d={},i=[],g=t[8],n=t[9],u=t[10],m=t[11];return d.faves=t[3],d.gallery=t[4],d.pool=t[5],d.set=t[6],d.stream=t[7],e.Object.each(d,(function(t,o){r[o]&&e.Array.each(r[o],(function(o){e.APIHelper.response.addContextToRegistry(o,t,a,m),i.push(t.proxy(o.id))}))})),p.exists(o.id)||(s=p.add({id:o.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),p.setValue(o.id,"contexts",i)),g.addOrUpdate({id:o.id,total:r.totals&&r.totals.groups,groups:p.getContextsOfType(o.id,"group-pool-models")}),(l=p.getContextsOfType(o.id,"set-models")).forEach((function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))})),n.addOrUpdate({id:o.id,total:r.totals&&r.totals.sets,sets:l}),u.addOrUpdate({id:o.id,total:r.totals&&r.totals.galleries,galleries:p.getContextsOfType(o.id,"gallery-models")}),s}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});YUI.add("photo-contexts-models",(function(e){function t(e){t.superclass.constructor.call(this,e),this.getMorePromises={"group-pool-models":{},"set-models":{},"gallery-models":{}},this.continuationKeys={"group-pool-models":{},"set-models":{},"gallery-models":{}}}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return this.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext):e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},getMoreContextsOfType:function(t,r,o){var s,n,i,l,a,p,u,c=this,g="-1",d=e.APIHelper.request.getRebootPhotoExtras();switch(r){case"group-pool-models":s="flickr.photos.getGroups",i="groups.group",d+=","+e.APIHelper.request.getRebootGroupExtras();break;case"set-models":s="flickr.photos.getSets",i="sets.set";break;case"gallery-models":s="flickr.photos.getGalleries",i="galleries.gallery"}return s?this.exists(t)?(l=this.continuationKeys[r][t]||"0")===g?e.Promise.resolve({type:r,newContexts:[],loadedAll:!0}):(n={photo_id:t,extras:d,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:l,per_page:o},p=t+"_"+l,(u=this.getMorePromises[r][p])?u:(this.getMorePromises[r][p]=new e.FlickrPromise({apiResponse:this.appContext.callAPI(s,n,!0),contextRegistry:this.appContext.getModelRegistry(r),personRegistry:this.appContext.getModelRegistry("person-models")}).then((function(o){var s,n,l,u=[],d=o.apiResponse,f=o.contextRegistry,h=o.personRegistry;return(n=i.split(".").reduce((function(t,r){return e.Lang.isObject(t)?t[r]:void 0}),d))&&(e.Array.each(n,(function(t){e.APIHelper.response.addContextToRegistry(t,f,h),u.push(f.proxy(t.id))})),u.length&&(l=c.getContextsOfType(t,r).map((function(e){return e.getValue("id")})),(u=u.filter((function(e){return-1===l.indexOf(e.getValue("id"))}))).length&&c.getValue(t,"contexts").appendToListMulti(u))),void 0===(a=d.continuation)?a=g:e.Lang.isNumber(a)&&(a+=""),s=a===g,c.continuationKeys[r][t]=a,delete c.getMorePromises[r][p],{type:r,newContexts:u,loadedAll:s}})),this.getMorePromises[r][p])):e.Promise.reject("[photo-contexts-models] getMoreContextsOfType was called for an ID that isn't in the registry: "+t):e.Promise.reject("[photo-contexts-models] getMoreContextsOfType was called without an invalid type: "+r)},getContextsOfType:function(t,r){return r=e.Array(r),this.getValue(t,"contexts").getList().filter((function(e){return r.indexOf(e.registry.name)>-1}))},getContextsNotOfType:function(t,r){return r=e.Array(r),this.getValue(t,"contexts").getList().filter((function(e){return-1===r.indexOf(e.registry.name)}))},attributes:{contexts:{isCollection:!0},totalGroups:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalSets:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalGalleries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})}),"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-photos-getAllContexts-fetcher"]});YUI.add("albums-list-page-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("albums-list-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.isOwner=e.isOwner,this.withSetId=e.withSetId,this.pageParams=e.pageParams,e.modelRegistryName="sets-models",e.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,e.photoListConfig={modelParams:{registryName:"sets-models",modelIdOrAttributes:e.nsid,collectionAttributeName:"albumsList"},interactionViewName:"photo-list-album-interaction-view",engagementModelName:"set-models",viewBeaconRestrictedAttribute:"primaryNeedsInterstitial",parentName:this.name,pageParams:e.pageParams,viewBeaconAttribute:"primary",measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:e.withSetId},e.photoListConfig.layout={targetRowHeight:240,forceAspectRatio:1,containerPadding:{top:8,right:0,bottom:8,left:0},itemSpacing:{horizontal:32,vertical:32}},this.isMobile&&(e.photoListConfig.layout.targetRowHeight=200,e.photoListConfig.layout.containerPadding.right=16,e.photoListConfig.layout.containerPadding.left=16,e.photoListConfig.layout.itemSpacing.horizontal=16,e.photoListConfig.layout.itemSpacing.vertical=16),e.subnavConfig={selected:"albums"},this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-list-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["fluid-centered"]},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("sets-models",this.nsid),this.appContext.getModel("person-models",this.nsid)]).then((function(e){t.set("albumsListModel",e[0]),t.set("totalItems",e[0].getValue("totalItems")),t.set("owner",e[1])}))},buildContainer:function(){var e,t,i=this.get("totalItems");return t=this.pageParams.page>1||i>Math.abs((this.pageParams.viewPageSize||20)*(this.pageParams.page||1)),e=i>0,this.setContainerWithTemplate("albums-list-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"","album-list-toolbar-view":e?this.subviews["album-list-toolbar-view"].get("container"):"",showPagination:t,isEmpty:0===this.get("totalItems").length,isViewingSelf:this.nsid===this.appContext.getViewer().nsid}),this},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),e+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),e+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",e):(this.set("headContainer",this.subviews["pagination-view"].get("headContainer")),this.updateHead())},showBalls:function(){this.balls||(this.balls=e.Node.create('<div class="loading-balls"></div>'),this.balls.setHTML(this.templates("flickr-balls")({}))),this.get("container").append(this.balls)},hideBalls:function(){this.balls.remove()},downloadAlbum:function(t){var i,o,a=this;return e.rapidTracker.beacon(this.name,"openDownloadAlbum"),(o=e.Array.find(this.get("albumsListModel").getOwnedModels(),(function(e){return e.id===t})))&&this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===o.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),1===o.getValue("totalCount")?o.getValue("photoPageList").getPage({page:1,perPage:1}).then((function(t){var i,o,s,n=t[0];n.getValue("isVideo")&&!a.appContext.flipper.isFlipped("disable-video-playback")?o="/video_download.gne?id="+n.id:(i=(s=n.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),0===(o=s.join(".")+"_d."+i).indexOf("//")&&(o="https:"+o)),e.config.doc.location.href=o})):o.getValue("totalCount")>e.config.flickr.downloadr.max_album_items?this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:o.getValue("owner").getValue("displayname"),userurl:o.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+o.id})):(i=a.bulkDownloaderView.createTitle(o.getValue("photoCount"),o.getValue("videoCount")),void a.bulkDownloaderView.showDownloadDialog({title:i,setID:t}))},shareAlbum:function(t,i){var o=new e.Views.FluidShareAlbumView({appContext:this.appContext,albumId:t});this.showBalls(),o.on("sharePresentationClose",o.destroy.bind(o)),o.initialize().then(function(){this.prepareModal(i)}.bind(o)).then(function(){this.hideBalls()}.bind(this)).catch(function(e){this.hideBalls()}.bind(this))},deleteAlbum:function(t){var o=this;return this.confirmAlbumDelete(t).then((function(){return o.appContext.getModel("set-models",t).then((function(i){var a=[];return i.toJSON().photoPageList.forEach((function(e){a.push(o.appContext.getModel("photo-sets-models",e.id).then((function(e){e.getValue("sets").removeFromList(t)})))})),a.push(i.registry.remoteDelete(t).then((function(){o.get("albumsListModel").getValue("albumsList").remove(t),o.appContext.flapp.navigate(e.config.doc.location.href)}))),e.Promise.all(a)}))})).catch((function(e){i.error("Error deleting album",{err:e})}))},confirmAlbumDelete:function(t){return new e.Promise(((t,i)=>{let o=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.CONFIRMATION"}),htmlMessage:this.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"}),confirmButtonIsDangerous:!0,onConfirm:()=>t()}),hasSubviewConfigRefactor:!0}).show();this.registerEventHandler(o.on("close",(()=>i())))}))},handleClick:function(e){var t,i=e.target;i.hasClass("cta")&&(e.halt(),t=i.ancestor(".photo-list-album-interaction").getData("albumId"),i.hasClass("is-disabled")||(i.hasClass("share")?this.shareAlbum(t,i):i.hasClass("book")?this.appContext.flapp.navigate("/create"):i.hasClass("download")?this.downloadAlbum(t):i.hasClass("trash")&&this.deleteAlbum(t)))},destructor:function(){this.balls&&this.balls.inDoc()&&this.balls.remove(),this.balls=null,this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick,this)),this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext}),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handlePageResize.bind(this))),this},handlePageResize:function(){e.config.win.innerWidth<=700?this.hasBeenMobilized||(this.hasBeenMobilized=!0,this.subviews["photo-list-view"].photoListLayout.targetRowHeight=200,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=16,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=16):(this.hasBeenMobilized&&(this.subviews["photo-list-view"].photoListLayout.targetRowHeight=240,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=0,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=0,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=32,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=32),this.hasBeenMobilized=!1)},onError:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:t,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show(),this.errorDialog}},{ATTRS:{}})}),"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-albums-list-page","global-nav-view","footer-full-view","pagination-view","fluid-photostream-coverphoto-view","fluid-share-album-view","hermes-template-flickr-balls","album-list-toolbar-view","hermes-template-head-link","hermes-template-head-meta"],optionalRequires:["bulk-downloader-view","hermes-core"],optional:["sets-models"],langBundles:["album-page","common","downloadr","magic-empty-states","meta"]});YUI.add("person-contacts-count-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-contacts-getInfo"].run(e,this.appContext)}},attributes:{followerCount:{defaultFn:function(){return 0}},followingCount:{defaultFn:function(){return 0}},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-contacts-getInfo-fetcher","attribute-helpers"]});YUI.add("flickr-people-contacts-getInfo-fetcher",(function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-people-contacts-getInfo"]={run:function(r,s){var o=this;return new e.FlickrPromise({apiResponse:s.callAPI("flickr.people.getInfo",this._processParams(r)),personContactsModelRegistry:s.getModelRegistry("person-contacts-count-models")}).then((function(e){return o._processResponse(e,r)}),e.FetcherErrorLogger(t))},_processParams:function(e){var t={datecreate:1,extras:"rev_contacts, contacts"};if(e.extras&&"string"==typeof e.extras&&e.extras.length>0&&(t.extras=t.extras+","+e.extras),e.id)t.user_id=e.id;else{if(!e.pathAlias)throw new Error("`fetch` is missing required params.");t.url=e.pathAlias}return t},_processResponse:function(e){var t=e.apiResponse,r=e.personContactsModelRegistry,s=t.person,o=s.id;return r.addOrUpdate({id:o,followerCount:s.revContacts&&parseInt(s.revContacts._content,10),followingCount:parseInt(s.contacts,10),pathAlias:s.pathAlias}),s}}}),"@VERSION@",{requires:["flickr-promise"],optional:["person-contacts-count-models","api-helper"]});YUI.add("hermes-lang-downloadr",(function(e,a){e.Intl.add("hermes/downloadr","en-US",{DOWNLOAD_WHEN_READY:[{type:0,value:"We’ll zip up these items and send you a FlickrMail with a link to download them when they are ready."}],DOWNLOAD_WHEN_READY_LOGGED_OUT:[{type:0,value:"We’ll zip up these items and give you a link to download them when they are ready."}],BE_SURE_RIGHTS:[{type:0,value:"These items belong to another Flickr member and they own the copyright. Be sure you respect the license on each of these items."}],CREATE_ZIP:[{type:0,value:"Create zip file"}],CREATING_ZIP:[{type:0,value:"Creating your zip file...<br>keep this window open"}],CREATING_ZIP_LOGGED_IN:[{type:0,value:"Creating your zip file...<br>"}],HAVE_QUESTIONS:[{type:0,value:'Have questions? Visit the <a target="_blank" href="'},{type:1,value:"url"},{type:0,value:'">download help page</a> or the <a target="_blank" href="/forum">Flickr Help Forum</a>.<br>No worries, links open in a new window.'}],PLEASE_WAIT:[{type:0,value:"Please wait"}],DOWNLOADS_READY:[{type:6,value:"num",options:{one:{value:[{type:0,value:"Your zip file of "},{type:7},{type:0,value:" items is ready to download"}]},other:{value:[{type:0,value:"Your zip files of "},{type:7},{type:0,value:" items are ready to download"}]}},offset:0,pluralType:"cardinal"}],DOWNLOAD_ZIP_FILE:[{type:0,value:"Download zip file"}],DOWNLOAD_ZIP_FILES:[{type:0,value:"Download zip file "},{type:2,value:"num",style:null}],POLLING_ERROR:[{type:0,value:"An error occured retrieving this download.  Please try again later."}],FAILED:[{type:0,value:"Failed"}],FAILED_DOWNLOAD:[{type:0,value:"Creating the zip file has failed.<br>Please try again later."}],TOOLTIP_DOWNLOAD_LINK_MESSAGE:[{type:0,value:'A FlickrMail with your download link will appear here shortly or <a target="_blank" href="'},{type:1,value:"url"},{type:0,value:'">view the progress</a>.'}],TOOLTIP_OK:[{type:0,value:"OK, thanks"}],CAMERAROLL_TOO_MANY:[{type:0,value:"We can only process <b>up to 500 photos</b> from the Camera Roll at a time. Please select fewer photos and try again."}],TOO_MANY_TITLE:[{type:0,value:"Whoa, that’s a lot of photos!"}],ALBUM_TOO_MANY_OWN:[{type:0,value:'We can only process albums with <b>fewer than 500 photos</b>. Please use <a target="_blank" href="/cameraroll">Camera Roll</a> or <a target="_blank" href="'},{type:1,value:"url"},{type:0,value:'">Organizr</a> to create smaller albums or to remove photos from this one, then try again.'}],ALBUM_TOO_MANY_OTHER:[{type:0,value:'We can only process albums with <b>fewer than 500 photos</b>. Please ask <a target="_blank" href="'},{type:1,value:"userurl"},{type:0,value:'">'},{type:1,value:"username"},{type:0,value:"</a> to create smaller albums or to remove photos from this one, then try again."}]})}),"@VERSION@",{requires:["intl"]});