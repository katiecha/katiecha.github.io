YUI.add("flickr-photosets-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getContext",this._processParams(t,s),!0),s.getModelRegistry("set-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then((function(e){return r._processResponse(e,t)}),(function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e})).then(null,e.FetcherErrorLogger(o))},_processParams:function(o,t){var s={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,get_photoset_info:1};return o.gpCode?(s.share_code=o.gpCode,s.share_owner=o.gpOwner,s.gp_code=o.gpCode,s.gp_owner=o.gpOwner):s.photoset_id=o.id,s},_processResponse:function(o,t){var s,r,n,p,h,i,a,d,g=o[0],l=o[1],u=o[2],m=o[3],c=o[4],x=o[5],y=[],M=u.proxy(t.photoId);return r=g.prevphotos,n=g.nextphotos,s=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),y=e.APIHelper.response.parsePhotos({photos:n.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),p=!!(i=l.getValue(t.id,"photoContextList")).hasMinBoundary&&i.hasMinBoundary(),h=!!i.hasMaxBoundary&&i.hasMaxBoundary(),a=i.getList(),d=e.APIHelper.response.addOrReplaceListByContext({model:M,next:s,prev:y.reverse(),current:a,hasMin:p,hasMax:h,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",d),{next:s,previous:y.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-create-creator",(function(t,e){"use strict";t.namespace("ModelCreators")["flickr-photosets-create"]={run:function(o,s){var p={},i=[];return p.title=o.title,p.description=o.description,p.primary_photo_id=o.photoID,p.full_result=1,i=[s.callAPI("flickr.photosets.create",p),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),t.Promise.all(i).then((function(e){var s,p,i,l,r,h=e[0],d=e[1],a=e[2],n=e[3],u=e[4],g=e[5];return!!h.photoset.id&&(o.isMultiplePhotos?o.numberOfPhotosSelected+o.numberOfVideosSelected===1?(l=h.photoset.photos,r=h.photoset.videos):h.photoset.photos?(l=h.photoset.photos,r=0):(r=h.photoset.videos,l=0):(p=e[6],l=h.photoset.photos,r=h.photoset.videos),s={id:h.photoset.id,title:h.photoset.title.content,photoPageList:o.isMultiplePhotos?[]:[p],photoContextList:o.isMultiplePhotos?[]:[p],owner:a,primary:h.photoset.primary,primaryPhotoSizes:t.APIHelper.response.parsePrimaryPhotoSizes(h.photoset),isAutoUploadSet:!1,photoCount:l,videoCount:r,totalCount:1,viewCount:h.countViews||0},d.add(s),i=d.proxy(h.photoset.id),n.getValue("albumsList").unshift(i),u.exists(o.photoID)&&!u.getValue(o.photoID,"sets").getFromListByID(i.getValue("id"))&&(u.getValue(o.photoID,"sets").prependToList(i),u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")+1)),g.exists(o.photoID)&&!g.getValue(o.photoID,"contexts").getFromListByID(i.getValue("id"))&&(g.setValue(o.photoID,"totalSets",g.getValue(o.photoID,"totalSets")+1),g.getValue(o.photoID,"contexts").appendToList(i)),i)}),t.FetcherErrorLogger(e))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-createHidden-creator",(function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:function(t,s){var r,d={};return d.photo_ids=t.photoIds,r=[s.callAPI("flickr.photosets.createHidden",d),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid)],e.Promise.all(r).then((function(e){var o,t=e[0],s=e[1],r=e[2];return!("ok"!==t.stat||!t.photoset.share_code)&&(o={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:r,gpCode:t.photoset.share_code,gpOwner:r.getValue("pathAlias")||r.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},s.add(o),s.proxy(o.id))}),e.FetcherErrorLogger(o))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-editMeta-updater",(function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(o,s){var r={},i=this;return r.photoset_id=o.photosetId,r.title=o.title,r.description=o.description,o.includeHiddenSets&&(r.extras="hidden_sets"),e.Promise.all([s.callAPI("flickr.photosets.editMeta",r),s.getModelRegistry("set-models")]).then((function(e){i._processResponse(e,o,s)}),e.FetcherErrorLogger(t))},_processResponse:function(e,t,s){var r=e[0],i=e[1];if(r.photoset&&r.photoset.title&&r.photoset.description){if(!i.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");i.setValues(t.photosetId,{title:r.photoset.title.content,description:r.photoset.description.content})}else o.warn("No updated data returned from API.")}}}),"@VERSION@",{requires:["flickr-promise"],optionalRequires:["hermes-core"]});YUI.add("flickr-photosets-setPrimaryPhoto-updater",(function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(o,e){var s={};return s.photoset_id=o.albumId,s.photo_id=o.photoId,e.callAPI("flickr.photosets.setPrimaryPhoto",s).then(null,r.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-getList-fetcher",(function(e,t){"use strict";e.namespace("ListFetchers")["flickr-photosets-getList"]={run:function(s,o){var a=this,r=this._processParams(s);return e.Promise.all([o.callAPI("flickr.photosets.getList",r,!0),o.getModelRegistry("sets-models"),o.getModelRegistry("set-models"),o.getModel("person-models",s.id||{pathAlias:s.pathAlias})]).then((function(e){return a._processResponse(e,s)}),e.FetcherErrorLogger(t))},_processParams:function(t){var s={primary_photo_extras:e.APIHelper.request.getRebootAlbumsListExtras(),page:t.page,per_page:t.perPage||500,get_user_info:1,extras:"can_share,can_download"};if(t.id)s.user_id=t.id;else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");s.path_alias=t.pathAlias}return s},_processResponse:function(t,s){var o,a,r=t[0],i=t[1],p=t[2],n=t[3],l=r.photosets,h={},d=n.getValue("id"),c=[];if(l)return l.photoset&&e.Array.each(l.photoset,(function(t,s){if(0!==t.visibilityCanSeeSet){var o={id:t.id,title:t.title.content,description:t.description.content,owner:n,primary:t.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),isAutoUploadSet:t.autoUpload,primaryNeedsInterstitial:t.needsInterstitial,photoCount:t.photos,videoCount:t.videos,publicPhotosCount:t.countPhotosPublic,totalCount:parseInt(t.photos,10)+parseInt(t.videos,10),viewCount:t.countViews,canShare:t.canShare+(t.canShareDeep||0),canDownload:t.canDownload};c.push(p.addOrUpdate(o))}})),h={id:d,pathAlias:n.getValue("pathAlias"),totalItems:r.photosets.total},o=parseInt(r.photosets.perpage),a=parseInt(r.photosets.page),h.albumsList={perPage:o,page:a,pageContent:c,totalItems:r.photosets.total,totalPages:Math.ceil(r.photosets.total/o)},i.addOrUpdate(h),c}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]});YUI.add("sets-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photosets-getList"].run(e,this.appContext)}},attributes:{id:{},pathAlias:{},albumsList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photosets-getList"]}},totalItems:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]});