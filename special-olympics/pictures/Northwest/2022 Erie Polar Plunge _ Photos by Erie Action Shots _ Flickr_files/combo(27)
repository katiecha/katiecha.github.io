YUI.add("hermes-template-fluid-droparound",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,o){return" html"},3:function(n,l,t,e,o){return" subview-droparound"},5:function(n,l,t,e,o){return" menu"},7:function(n,l,t,e,o){return" auto-size"},9:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"height: "+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"staticHeight")||(null!=l?i(l,"staticHeight"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"staticHeight",hash:{},data:o,loc:{start:{line:2,column:35},end:{line:2,column:51}}}):a)+"px;"},11:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"max-height: "+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"maxHeight")||(null!=l?i(l,"maxHeight"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"maxHeight",hash:{},data:o,loc:{start:{line:3,column:29},end:{line:3,column:42}}}):a)+"px;"},13:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"width: "+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"staticWidth")||(null!=l?i(l,"staticWidth"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"staticWidth",hash:{},data:o,loc:{start:{line:4,column:26},end:{line:4,column:41}}}):a)+"px;"},15:function(n,l,t,e,o){return"position: fixed;"},17:function(n,l,t,e,o){return"hide-head"},19:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"max-height: "+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"maxHeight")||(null!=l?i(l,"maxHeight"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"maxHeight",hash:{},data:o,loc:{start:{line:9,column:55},end:{line:9,column:68}}}):a)+"px; overflow: auto;"},21:function(n,l,t,e,o){var a,i,r=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="content text-only'+(null!=(a=c(t,"if").call(r,null!=l?c(l,"autoSizeToContent"):l,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:11,column:32},end:{line:11,column:74}}}))?a:"")+'" style="'+(null!=(a=(c(t,"ifDefined")||l&&c(l,"ifDefined")||u).call(r,null!=l?c(l,"contentPadding"):l,{name:"ifDefined",hash:{},fn:n.program(22,o,0),inverse:n.noop,data:o,loc:{start:{line:11,column:83},end:{line:11,column:156}}}))?a:"")+'">\n\t\t\t\t'+n.escapeExpression("function"==typeof(i=null!=(i=c(t,"textMessage")||(null!=l?c(l,"textMessage"):l))?i:u)?i.call(r,{name:"textMessage",hash:{},data:o,loc:{start:{line:12,column:4},end:{line:12,column:19}}}):i)+"\n\t\t\t</div>\n"},22:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"padding: "+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"contentPadding")||(null!=l?i(l,"contentPadding"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"contentPadding",hash:{},data:o,loc:{start:{line:11,column:121},end:{line:11,column:139}}}):a)+"px;"},24:function(n,l,t,e,o){var a,i=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="content html-only'+(null!=(a=u(t,"if").call(i,null!=l?u(l,"autoSizeToContent"):l,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:32},end:{line:16,column:74}}}))?a:"")+'" style="'+(null!=(a=(u(t,"ifDefined")||l&&u(l,"ifDefined")||r).call(i,null!=l?u(l,"contentPadding"):l,{name:"ifDefined",hash:{},fn:n.program(22,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:83},end:{line:16,column:156}}}))?a:"")+'">\n\t\t\t\t'+n.escapeExpression((u(t,"renderTrustedMarkup")||l&&u(l,"renderTrustedMarkup")||r).call(i,null!=l?u(l,"htmlMessage"):l,{name:"renderTrustedMarkup",hash:{},data:o,loc:{start:{line:17,column:4},end:{line:17,column:39}}}))+"\n\t\t\t</div>\n"},26:function(n,l,t,e,o){var a,i=null!=l?l:n.nullContext||{},r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="content subview'+(null!=(a=r(t,"if").call(i,null!=l?r(l,"autoSizeToContent"):l,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:21,column:30},end:{line:21,column:72}}}))?a:"")+'" style="'+(null!=(a=(r(t,"ifDefined")||l&&r(l,"ifDefined")||n.hooks.helperMissing).call(i,null!=l?r(l,"contentPadding"):l,{name:"ifDefined",hash:{},fn:n.program(22,o,0),inverse:n.noop,data:o,loc:{start:{line:21,column:81},end:{line:21,column:154}}}))?a:"")+'"></div>\n'},28:function(n,l,t,e,o,a,i){var r,u=null!=l?l:n.nullContext||{},c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="content menu" style="'+(null!=(r=(c(t,"ifDefined")||l&&c(l,"ifDefined")||n.hooks.helperMissing).call(u,null!=l?c(l,"contentPadding"):l,{name:"ifDefined",hash:{},fn:n.program(22,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:24,column:36},end:{line:24,column:109}}}))?r:"")+'">\n\t\t\t\t<ul role="menu">\n'+(null!=(r=c(t,"each").call(u,null!=l?c(l,"menuItems"):l,{name:"each",hash:{},fn:n.program(29,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:26,column:5},end:{line:44,column:14}}}))?r:"")+"\t\t\t\t</ul>\n\t\t\t</div>\n"},29:function(n,l,t,e,o,a,i){var r,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(r=u(t,"if").call(null!=l?l:n.nullContext||{},null!=i[1]?u(i[1],"multiSelect"):i[1],{name:"if",hash:{},fn:n.program(30,o,0,a,i),inverse:n.program(35,o,0,a,i),data:o,loc:{start:{line:27,column:6},end:{line:43,column:13}}}))?r:""},30:function(n,l,t,e,o){var a,i,r=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t\t\t<li role="menuitem" '+(null!=(a=u(t,"if").call(r,null!=l?u(l,"selected"):l,{name:"if",hash:{},fn:n.program(31,o,0),inverse:n.noop,data:o,loc:{start:{line:28,column:27},end:{line:28,column:66}}}))?a:"")+'>\n\t\t\t\t\t\t\t\t<span class="selection"></span>\n\t\t\t\t\t\t\t\t'+n.escapeExpression("function"==typeof(i=null!=(i=u(t,"text")||(null!=l?u(l,"text"):l))?i:n.hooks.helperMissing)?i.call(r,{name:"text",hash:{},data:o,loc:{start:{line:30,column:8},end:{line:30,column:16}}}):i)+(null!=(a=u(t,"if").call(r,null!=l?u(l,"itemFlag"):l,{name:"if",hash:{},fn:n.program(33,o,0),inverse:n.noop,data:o,loc:{start:{line:30,column:16},end:{line:30,column:95}}}))?a:"")+"\n\t\t\t\t\t\t\t</li>\n"},31:function(n,l,t,e,o){return'class="selected"'},33:function(n,l,t,e,o){var a,i=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,u="function",c=n.escapeExpression,s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return" - "+c(typeof(a=null!=(a=s(t,"itemFlag")||(null!=l?s(l,"itemFlag"):l))?a:r)===u?a.call(i,{name:"itemFlag",hash:{},data:o,loc:{start:{line:30,column:35},end:{line:30,column:47}}}):a)+'<div class="label-new">'+c(typeof(a=null!=(a=s(t,"itemFlag")||(null!=l?s(l,"itemFlag"):l))?a:r)===u?a.call(i,{name:"itemFlag",hash:{},data:o,loc:{start:{line:30,column:70},end:{line:30,column:82}}}):a)+"</div>"},35:function(n,l,t,e,o){var a,i,r=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\tclass="'+(null!=(a=u(t,"if").call(r,null!=l?u(l,"hasDivider"):l,{name:"if",hash:{},fn:n.program(36,o,0),inverse:n.noop,data:o,loc:{start:{line:34,column:15},end:{line:34,column:52}}}))?a:"")+"\n\t\t\t\t\t\t\t\t\t"+(null!=(a=u(t,"if").call(r,null!=l?u(l,"isSelected"):l,{name:"if",hash:{},fn:n.program(38,o,0),inverse:n.noop,data:o,loc:{start:{line:35,column:9},end:{line:35,column:48}}}))?a:"")+"\n\t\t\t\t\t\t\t\t\t"+(null!=(a=u(t,"if").call(r,null!=l?u(l,"wordWrap"):l,{name:"if",hash:{},fn:n.program(40,o,0),inverse:n.noop,data:o,loc:{start:{line:36,column:9},end:{line:36,column:42}}}))?a:"")+"\n\t\t\t\t\t\t\t\t\t"+(null!=(a=u(t,"if").call(r,null!=l?u(l,"disabled"):l,{name:"if",hash:{},fn:n.program(42,o,0),inverse:n.noop,data:o,loc:{start:{line:37,column:9},end:{line:37,column:41}}}))?a:"")+'"\n\t\t\t\t\t\t\t\t'+(null!=(a=u(t,"if").call(r,null!=l?u(l,"href"):l,{name:"if",hash:{},fn:n.noop,inverse:n.program(44,o,0),data:o,loc:{start:{line:38,column:8},end:{line:38,column:39}}}))?a:"")+">\n\t\t\t\t\t\t\t\t"+(null!=(a=u(t,"if").call(r,null!=l?u(l,"href"):l,{name:"if",hash:{},fn:n.program(46,o,0),inverse:n.noop,data:o,loc:{start:{line:39,column:8},end:{line:39,column:92}}}))?a:"")+"\n\t\t\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(i=null!=(i=u(t,"text")||(null!=l?u(l,"text"):l))?i:n.hooks.helperMissing)?i.call(r,{name:"text",hash:{},data:o,loc:{start:{line:40,column:9},end:{line:40,column:17}}}):i)+(null!=(a=u(t,"if").call(r,null!=l?u(l,"itemFlag"):l,{name:"if",hash:{},fn:n.program(49,o,0),inverse:n.noop,data:o,loc:{start:{line:40,column:17},end:{line:40,column:81}}}))?a:"")+"\n\t\t\t\t\t\t\t\t"+(null!=(a=u(t,"if").call(r,null!=l?u(l,"href"):l,{name:"if",hash:{},fn:n.program(51,o,0),inverse:n.noop,data:o,loc:{start:{line:41,column:8},end:{line:41,column:31}}}))?a:"")+"\n\t\t\t\t\t\t\t</li>\n"},36:function(n,l,t,e,o){return" has-divider"},38:function(n,l,t,e,o){return" selected-item"},40:function(n,l,t,e,o){return" word-wrap"},42:function(n,l,t,e,o){return" disabled"},44:function(n,l,t,e,o){return'tabindex="0"'},46:function(n,l,t,e,o){var a,i,r=null!=l?l:n.nullContext||{},u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<a href="'+n.escapeExpression("function"==typeof(i=null!=(i=u(t,"href")||(null!=l?u(l,"href"):l))?i:n.hooks.helperMissing)?i.call(r,{name:"href",hash:{},data:o,loc:{start:{line:39,column:29},end:{line:39,column:37}}}):i)+'"'+(null!=(a=u(t,"if").call(r,null!=l?u(l,"className"):l,{name:"if",hash:{},fn:n.program(47,o,0),inverse:n.noop,data:o,loc:{start:{line:39,column:38},end:{line:39,column:84}}}))?a:"")+">"},47:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' class="'+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"className")||(null!=l?i(l,"className"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"className",hash:{},data:o,loc:{start:{line:39,column:63},end:{line:39,column:76}}}):a)+'"'},49:function(n,l,t,e,o){var a,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<div class="label-new">'+n.escapeExpression("function"==typeof(a=null!=(a=i(t,"itemFlag")||(null!=l?i(l,"itemFlag"):l))?a:n.hooks.helperMissing)?a.call(null!=l?l:n.nullContext||{},{name:"itemFlag",hash:{},data:o,loc:{start:{line:40,column:56},end:{line:40,column:68}}}):a)+"</div>"},51:function(n,l,t,e,o){return"</a>"},53:function(n,l,t,e,o){return"hide-foot"},55:function(n,l,t,e,o){return'\t\t<div class="droparrow up"></div>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,o,a,i){var r,u,c=null!=l?l:n.nullContext||{},s=n.hooks.helperMissing,m="function",p=n.escapeExpression,f=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<div class="droparound'+(null!=(r=f(t,"if").call(c,null!=l?f(l,"htmlMessage"):l,{name:"if",hash:{},fn:n.program(1,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:1,column:22},end:{line:1,column:53}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"subview"):l,{name:"if",hash:{},fn:n.program(3,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:1,column:53},end:{line:1,column:94}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"menuItems"):l,{name:"if",hash:{},fn:n.program(5,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:1,column:94},end:{line:1,column:123}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"autoSizeToContent"):l,{name:"if",hash:{},fn:n.program(7,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:1,column:123},end:{line:1,column:165}}}))?r:"")+" "+p(typeof(u=null!=(u=f(t,"classList")||(null!=l?f(l,"classList"):l))?u:s)===m?u.call(c,{name:"classList",hash:{},data:o,loc:{start:{line:1,column:166},end:{line:1,column:179}}}):u)+'"\nstyle="'+(null!=(r=f(t,"if").call(c,null!=l?f(l,"staticHeight"):l,{name:"if",hash:{},fn:n.program(9,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:2,column:7},end:{line:2,column:61}}}))?r:"")+"\n"+(null!=(r=f(t,"if").call(c,null!=l?f(l,"maxHeight"):l,{name:"if",hash:{},fn:n.program(11,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:3,column:0},end:{line:3,column:52}}}))?r:"")+"\n"+(null!=(r=f(t,"if").call(c,null!=l?f(l,"staticWidth"):l,{name:"if",hash:{},fn:n.program(13,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:4,column:0},end:{line:4,column:51}}}))?r:"")+"\n"+(null!=(r=f(t,"if").call(c,null!=l?f(l,"positionFixed"):l,{name:"if",hash:{},fn:n.program(15,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:5,column:0},end:{line:5,column:44}}}))?r:"")+'">\n\t<div class="head '+(null!=(r=f(t,"unless").call(c,null!=l?f(l,"headContent"):l,{name:"unless",hash:{},fn:n.program(17,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:6,column:18},end:{line:6,column:61}}}))?r:"")+'">\n\t\t'+p(typeof(u=null!=(u=f(t,"headContent")||(null!=l?f(l,"headContent"):l))?u:s)===m?u.call(c,{name:"headContent",hash:{},data:o,loc:{start:{line:7,column:2},end:{line:7,column:17}}}):u)+'\n\t</div>\n\t<div class="body" style="'+(null!=(r=f(t,"if").call(c,null!=l?f(l,"maxHeight"):l,{name:"if",hash:{},fn:n.program(19,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:9,column:26},end:{line:9,column:94}}}))?r:"")+'">\n'+(null!=(r=f(t,"if").call(c,null!=l?f(l,"textMessage"):l,{name:"if",hash:{},fn:n.program(21,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:10,column:2},end:{line:14,column:9}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"htmlMessage"):l,{name:"if",hash:{},fn:n.program(24,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:15,column:2},end:{line:19,column:9}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"subview"):l,{name:"if",hash:{},fn:n.program(26,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:20,column:2},end:{line:22,column:9}}}))?r:"")+(null!=(r=f(t,"if").call(c,null!=l?f(l,"menuItems"):l,{name:"if",hash:{},fn:n.program(28,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:23,column:2},end:{line:47,column:9}}}))?r:"")+'\t</div>\n\t<div class="foot '+(null!=(r=f(t,"unless").call(c,null!=l?f(l,"footContent"):l,{name:"unless",hash:{},fn:n.program(53,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:49,column:18},end:{line:49,column:61}}}))?r:"")+'">\n\t\t'+p(typeof(u=null!=(u=f(t,"footContent")||(null!=l?f(l,"footContent"):l))?u:s)===m?u.call(c,{name:"footContent",hash:{},data:o,loc:{start:{line:50,column:2},end:{line:50,column:17}}}):u)+"\n\t</div>\n"+(null!=(r=f(t,"if").call(c,null!=l?f(l,"showDropArrow"):l,{name:"if",hash:{},fn:n.program(55,o,0,a,i),inverse:n.noop,data:o,loc:{start:{line:52,column:1},end:{line:54,column:8}}}))?r:"")+"</div>\n"},useData:!0,useDepths:!0}),e={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/fluid-droparound",(function(l,o){return(o=o||{}).partials=o.partials?n.merge(e,o.partials):e,t(l,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-flickr-balls",(function(e,l){var a=e.Template.Handlebars.revive({1:function(e,l,a,r,n){return" block"},compiler:[8,">= 4.3.0"],main:function(e,l,a,r,n){var t,i=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<div class="balls '+(null!=(t=i(a,"if").call(null!=l?l:e.nullContext||{},null!=l?i(l,"isBlock"):l,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:1,column:18},end:{line:1,column:46}}}))?t:"")+'">\n\t<div class="blue ball"></div><div class="pink ball"></div>\n</div>'},useData:!0}),r={};e.Array.each([],(function(l){var a=e.Template.get("hermes/"+l);a&&(r[l]=a)})),e.Template.register("hermes/flickr-balls",(function(l,n){return(n=n||{}).partials=n.partials?e.merge(r,n.partials):r,a(l,n)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-droparound-view",(function(e,t){"use strict";var i,r,n,o=require("hermes-core/flog")(t);i={css:{destinationContainer:"body",subviewContent:".content.subview",menuContent:".content.menu",droparoundContainer:".droparound",droparoundContent:".body .content",droparrow:".droparrow"},options:{}},r={supportsTransform:!1,droparound:{height:0,width:0}},n=function(e,t,i){var r,n,o,a,s,l,u=e.x,c=e.y,d=e.width,h=e.height,v=e.viewportX,g=t.width,f=t.height,p=i.height,b=i.width,w=i.preferredHorizontalOrientation,H=i.preferredVerticalOrientation,m=c<f/2,A=u<g/2;return"down"===H&&(m=!0),"up"===H&&(m=!1),"right"===w&&(A=!0),"left"===w&&(A=!1),i.ignoreBoundary||(p>v&&(m=!0),c+h+p<v&&(m=!1)),r=d*i.anchorPivotHoriz,m?(s=c+h,l=c+h+p,n={vertical:"down"}):(s=c-p,l=c,n={vertical:"up"}),A?(o=u+r-i.arrowOffset-i.arrowWidth/2,o=Math.min(o,g-t.paddingHorizontal-b),a=(o=Math.max(o,t.paddingHorizontal))+b,n.horizontal="right"):(a=u+r+i.arrowOffset+i.arrowWidth/2,a=Math.max(a,b+t.paddingHorizontal),o=(a=Math.min(a,g-t.paddingHorizontal))-b,n.horizontal="left"),{coords:[o,a,s,l],orientation:n}},e.namespace("Views").FluidDroparound=e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){this.set("isActiveViewAgnostic",!0)},buildContainer:function(){var e=this.get("width");if(!(this.get("textMessage")||this.get("htmlMessage")||this.get("subview")||this.get("menuItems")))return o.warn("requires a `textMessage`, `htmlMessage`, `subview`, or `menuItems`."),this;if(this.get("menuItems")&&this.set("menuItems",this.get("menuItems").filter((function(e){return!e.hidden}))),this.get("keepInsideViewportHoriz")){var t=this.appContext.viewportData.getWidth()-2*this.get("viewportPaddingHoriz");e=Math.min(this.get("width"),t)}return this.setContainerWithTemplate("fluid-droparound",{textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),menuItems:this.get("menuItems"),multiSelect:this.get("multiSelect"),showDropArrow:this.get("showDropArrow"),classList:this.get("classList"),footContent:this.get("footContent"),headContent:this.get("headContent"),staticWidth:e,staticHeight:this.get("height"),maxHeight:this.get("maxHeight"),positionFixed:this.get("positionFixed"),autoSizeToContent:this.get("autoSizeToContent"),contentPadding:this.get("contentPadding")}),this.overlayId=this.appContext.overlayManager.push({view:this,overlayClassList:this.get("overlayClassList"),hideOverlay:!0,dismissOnOverlayClick:this.get("dismissOnOverlayClick"),ignorePointerEvents:this.get("invisibleOverlay"),dismissOnEsc:!0,disableBodyScroll:!1,popBeforePushOther:this.get("popBeforePushOther"),requiredParentNode:this.get("anchorElement")}),this.appendAndPosition(),this},activate:function(){var t=this.get("container"),r=this;this.registerEventHandler(e.on("droparound:reposition",e.bind(this.anchorPositionChange,this))),this.registerEventHandler(e.on("history:change",(function(e){"popstate"===e.src&&e.prevVal&&e.newVal&&(e.prevVal.flickr&&e.prevVal.flickr.referrer||e.newVal.flickr&&e.newVal.flickr.referrer)||r.close(e)}))),this.get("useDefaultKeyboardNavigation")&&e.use("keyboard-manager",(function(e){r.registerEventHandler(t.on("keydown",r.keyboardNavigation,r))}));var n=this.get("anchorElement"),o=this.get("keyboardAnchorElement");return o||(o=n.hasAttribute("aria-haspopup")?n:n.ancestor("[aria-haspopup=true]")),o&&(this.set("keyboardAnchorElement",o),this.get("keyboardAnchorElement").setAttribute("aria-expanded","true"),this.registerEventHandler(o.on("key",this.enterDroparound,"down:40",this))),this.get("subview")&&this.loadSubview(),this.get("menuItems")&&this.registerEventHandler(t.one(i.css.menuContent).delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||this.onMenuItemClick(e)}.bind(this),"li")),this.get("observePageResize")&&this.observePageResize(),this.get("closeOnScroll")&&this.observePageScroll(),this.get("preventPageScrollOnScroll")&&this.registerEventHandler(t.on("mousewheel",this.preventPageScroll.bind(this))),this.fire("activated"),this},enterDroparound:function(e){var t=this.get("container").one("ul li");t&&(e.preventDefault(),t.focus())},keyboardNavigation:function(e){var t=e.keyCode,i=38===t||9===t&&e.shiftKey,r=40===t||9===t&&!e.shiftKey,n=e.target.ancestor("li",!0);if(!this.appContext.getKeyboardManager().inputHasFocus())if(i&&n&&n.previous("li"))e.preventDefault(),this.focusOnPreviousItem(e);else if(r)e.preventDefault(),n&&n.next("li")&&this.focusOnNextItem(e);else if(i){e.preventDefault();var o=this.get("keyboardAnchorElement");o&&(this.close(),o.focus(),o.removeClass("no-outline"))}},focusOnPreviousItem:function(e){var t=e.target.ancestor("li",!0);if(t){var i=t.previous("li");i&&(i.one("a")?i.one("a").focus():i.focus())}},focusOnNextItem:function(e){var t=e.target.ancestor("li",!0);if(t){var i=t.next("li");i&&(i.one("a")?i.one("a").focus():i.focus())}},getDroparoundContainer:function(){return this.get("container")?this.get("container").one(i.css.droparoundContainer):null},loadSubview:function(){var t,r,n=!1,o=this.get("subview"),a=this;(t=this.get("container").one(i.css.subviewContent)).addClass("loading"),t.appendChild(e.Node.create(this.templates("flickr-balls")({})).addClass("flickr-balls")),r=setTimeout((function(){n=!0}),40),this.loading=!0,o.appContext=a.appContext,o.set("isActiveViewAgnostic",!0),o.initialize().then((function(e){clearTimeout(r),n&&(e.get("container").addClass("load-transition"),setTimeout((function(){e.get("container").removeClass("load-transition")}),1)),a.onSubviewInitialized(e)}))},onSubviewInitialized:function(t){var r=this,n=this.get("container").one(i.css.subviewContent);this.loading&&(this.loading=!1,n.removeClass("loading"),n.one(".flickr-balls").remove(!0),n.appendChild(t.get("container")),t.on("subviewViewEvent",(function(e){e&&e.details&&e.details.length&&r.fire.apply(r,e.details)})),t.normalizedActivate(),t.recursivelyActivateSubviews(),r.appendAndPosition(),r.registerEventHandler(r.get("subview").on("actionClick",e.bind(r.handleAction,r))),r.registerEventHandler(r.get("subview").on("readyToClose",e.bind(r.close,r))))},onMenuItemClick:function(e){var t,r,n;if((t=e.target.ancestor("li",!0))&&-1!==(r=this.get("container").one(i.css.menuContent).all("li").indexOf(t))){if(n=this.get("menuItems")[r],!this.get("allowClicksOnDisabledItems")&&n.disabled)return;this.get("multiSelect")&&(n.selected=!n.selected,t.toggleClass("selected")),this.fire("selected",{menuItemIndex:r,menuItem:n,origEvent:e})}},appendAndPosition:function(t){e.one(i.css.destinationContainer);var n=this.get("container").one(i.css.droparoundContainer);this.appContext.overlayManager.placeViewAfterOverlay(this.overlayId),r.droparound.width=this.get("width")||n.getComputedStyle("width"),r.droparound.height=this.get("height")||n.getComputedStyle("height"),this.repositionToElement(t||this.get("anchorElement"))},updateTextMessage:function(e){e&&""!==e&&(this.set("textMessage",e),this.buildContainer())},updateHTMLMessage:function(e){e&&""!==e&&(this.set("htmlMessage",e),this.buildContainer())},anchorPositionChange:function(){this.repositionToElement(this.get("anchorElement"))},observePageResize:function(){var t=this;this.registerEventHandler(e.globalEvents.subscribe("window:resize",(function(i){e.fire("droparound:reposition"),t.get("closeOnResize")&&t.handleClose(i)})))},observePageScroll:function(){var t=YUI.Env.isServer?0:e.config.win.pageYOffset;this.get("startingScrollPoint")||this.set("startingScrollPoint",t),this.registerEventHandler(e.globalEvents.subscribe("window:scroll",this.handleScroll.bind(this)))},handleScroll:function(t){var i,r=this.get("startingScrollPoint");r?(i=e.config.win.pageYOffset,(r+this.get("closeOnScrollDistance")<i||r-this.get("closeOnScrollDistance")>i)&&this.handleClose(t)):this.set("startingScrollPoint",e.config.win.pageYOffset)},repositionToElement:function(e,t){var r,o,a=this.get("container"),s=this.get("positionFixed"),l=a.one(".droparound"),u=this.get("showDropArrow")?l.one(i.css.droparrow):void 0,c=l.one(i.css.droparoundContent),d=(c.get("offsetWidth"),c.get("offsetHeight"),u?u.get("offsetHeight"):0),h=u?u.get("offsetWidth"):0,v=e.getXY(),g=v[0],f=v[1],p=e.getDOMNode().getBoundingClientRect(),b=p.width;if(this.get("keepInsideViewportHoriz")){var w=this.appContext.viewportData.getWidth()-2*this.get("viewportPaddingHoriz"),H=this.get("width");H?l.setStyles({width:H}):l.setStyles({width:"auto"}),l.getDOMNode().getBoundingClientRect().width>w&&l.setStyles({width:w})}o=b*(r={width:l.get("offsetWidth"),height:l.get("offsetHeight"),arrowOffset:this.get("arrowOffset"),anchorPivotHoriz:this.get("anchorPivotHoriz"),arrowWidth:h}).anchorPivotHoriz,r.ignoreBoundary=!!t,this.get("preferLeft")&&(r.preferredHorizontalOrientation="left"),this.get("preferRight")&&(r.preferredHorizontalOrientation="right"),this.get("preferTop")&&(r.preferredVerticalOrientation="up"),this.get("preferBottom")&&(r.preferredVerticalOrientation="down"),(!this.anchorCoords||0!==this.x&&0!==this.y)&&(this.anchorCoords={x:s?p.left:g,y:s?p.top:f,width:p.width,height:p.height,viewportX:p.top||0});var m=n(this.anchorCoords,{width:this.appContext.viewportData.getWidth(),height:this.appContext.viewportData.getHeight(),paddingHorizontal:this.get("viewportPaddingHoriz")},r);if("down"===m.orientation.vertical?m.coords[2]+=d-this.get("anchorOffsetVertical"):m.coords[2]-=d+this.get("anchorOffsetVertical"),l.setStyles({left:m.coords[0],top:m.coords[2]}),u)if(u.removeClass("down").removeClass("up").removeClass("left").removeClass("right").addClass(m.orientation.vertical),"left"===m.orientation.horizontal){var A=this.appContext.viewportData.getWidth()-this.anchorCoords.x,C=this.appContext.viewportData.getWidth()-(r.width+m.coords[0]);u.setStyles({right:A-o-u.get("clientWidth")/2-C,left:"auto"})}else{var y=this.anchorCoords.x,I=m.coords[0];u.setStyles({left:y+o-u.get("clientWidth")/2-I})}},handleClose:function(e){this.close()},handleAction:function(e){this.fire("actionClick",e),this.get("dismissOnActionClick")&&this.close(e)},show:function(){var e=!this.isActivated,t=this;return this.initialize().then((function(){t.isClosed=!1,e||t.activate()})),this},close:function(){var e=this.get("container");if(!this.isClosed){this.loading=!1,this.isClosed=!0;var t=this.get("keyboardAnchorElement");t&&(t.setAttribute("aria-expanded","false"),t.focus(),t.addClass("no-outline")),this.fire("closeDroparound"),this.destroy(),this.get("subview")&&this.get("subview").destroy(),e&&e.remove(!0),this.appContext.overlayManager.pop(this.overlayId)}},destructor:function(){this.detachAll()},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},preventPageScroll:function(e){var t,i,r=this.get("container"),n=e.target,o=!1;if(r.contains(n)){for(;n!==r&&!o;)"hidden"===n.getStyle("overflow")||"visible"===n.getStyle("overflow")||n.get("offsetHeight")>=n.get("scrollHeight")?n=n.get("parentNode"):o=!0;o&&(t=e.wheelDelta<0,((i=n.getDOMNode()).scrollTop<=0&&!t||i.scrollTop+i.offsetHeight>=i.scrollHeight&&t)&&e.preventDefault())}}},{ATTRS:{dismissOnOverlayClick:{value:!0,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnActionClick:{value:!0,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},invisibleOverlay:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preferredSide:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},footContent:{value:null},headContent:{value:null},width:{value:0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},height:{value:0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},maxHeight:{value:0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},subview:{value:null},menuItems:{value:null},classList:{value:"",validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t,i){return e.AttributeHelpers.coerceString(t)}},anchorElement:{value:null},keyboardAnchorElement:{value:null},useDefaultKeyboardNavigation:{value:!0},showDropArrow:{value:!0,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},anchorOffsetVertical:{value:0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},arrowOffset:{value:8,validator:function(t,i){return e.AttributeHelpers.validateFloat(t)},setter:function(t,i){return e.AttributeHelpers.coerceFloat(t)}},keepInsideViewportHoriz:{value:!0,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},viewportPaddingHoriz:{value:2,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},anchorPivotHoriz:{value:.5,validator:function(t,i){return e.AttributeHelpers.validateFloat(t)},setter:function(t,i){return e.AttributeHelpers.coerceFloat(t)}},contentPadding:{value:void 0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},minVerticalSpace:{value:60,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},minHorizontalSpace:{value:60,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},dropdownArrowWidth:{value:21,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},dropdownArrowHeight:{value:11},anchorPositionOffset:{value:15,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},observePageResize:{value:!0,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preferLeft:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preferRight:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preferTop:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preferBottom:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},positionFixed:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},closeOnScroll:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},closeOnScrollDistance:{value:40,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},closeOnResize:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},overlayClassList:{value:"",validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t,i){return e.AttributeHelpers.coerceString(t)}},forceLeft:{value:null},forceRight:{value:null},autoSizeToContent:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},horizCenterToAnchor:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},multiSelect:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},preventPageScrollOnScroll:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},popBeforePushOther:{value:!1},allowClicksOnDisabledItems:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-fluid-droparound","hermes-template-flickr-balls","attribute-helpers"],optionalRequires:["fluid","hermes-core"]});YUI.add("hermes-template-notifications-panel",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,a,e){var i,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\twidth: "+n.escapeExpression("function"==typeof(i=null!=(i=s(l,"width")||(null!=t?s(t,"width"):t))?i:n.hooks.helperMissing)?i.call(null!=t?t:n.nullContext||{},{name:"width",hash:{},data:e,loc:{start:{line:4,column:9},end:{line:4,column:18}}}):i)+"px;\n"},3:function(n,t,l,a,e){var i,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"\t\theight: "+n.escapeExpression("function"==typeof(i=null!=(i=s(l,"height")||(null!=t?s(t,"height"):t))?i:n.hooks.helperMissing)?i.call(null!=t?t:n.nullContext||{},{name:"height",hash:{},data:e,loc:{start:{line:7,column:10},end:{line:7,column:20}}}):i)+"px;\n"},5:function(n,t,l,a,e){return" hidden"},7:function(n,t,l,a,e){var i,s=null!=t?t:n.nullContext||{},o=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<span role="button" class="tab" data-tab-id="admin">\n\t\t\t\t\t'+o((r(l,"intlMessage")||t&&r(t,"intlMessage")||n.hooks.helperMissing).call(s,{name:"intlMessage",hash:{intlName:"notifications.GROUPS_YOU_ADMIN"},data:e,loc:{start:{line:20,column:5},end:{line:20,column:63}}}))+'\n\t\t\t\t\t<span class="count-in-parens'+(null!=(i=r(l,"if").call(s,null!=(i=null!=t?r(t,"unreadCounts"):t)?r(i,"admin"):i,{name:"if",hash:{},fn:n.noop,inverse:n.program(5,e,0),data:e,loc:{start:{line:21,column:33},end:{line:21,column:73}}}))?i:"")+'">('+o(n.lambda(null!=(i=null!=t?r(t,"unreadCounts"):t)?r(i,"admin"):i,t))+")</span>\n\t\t\t\t</span>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,l,a,e){var i,s=null!=t?t:n.nullContext||{},o=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="notifications-panel"\n\tstyle="\n'+(null!=(i=c(l,"if").call(s,null!=t?c(t,"width"):t,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e,loc:{start:{line:3,column:1},end:{line:5,column:8}}}))?i:"")+(null!=(i=c(l,"if").call(s,null!=t?c(t,"height"):t,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.noop,data:e,loc:{start:{line:6,column:1},end:{line:8,column:8}}}))?i:"")+'\t">\n\t<div class="nav-container">\n\t\t<div class="tabs">\n\t\t\t<span role="button" class="tab selected" data-tab-id="main">\n\t\t\t\t<span>\n\t\t\t\t\t'+r((c(l,"intlMessage")||t&&c(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"notifications.NOTIFICATIONS"},data:e,loc:{start:{line:14,column:5},end:{line:14,column:60}}}))+'\n\t\t\t\t\t<span class="count-in-parens'+(null!=(i=c(l,"if").call(s,null!=(i=null!=t?c(t,"unreadCounts"):t)?c(i,"main"):i,{name:"if",hash:{},fn:n.noop,inverse:n.program(5,e,0),data:e,loc:{start:{line:15,column:33},end:{line:15,column:72}}}))?i:"")+'">('+r(n.lambda(null!=(i=null!=t?c(t,"unreadCounts"):t)?c(i,"main"):i,t))+")</span>\n\t\t\t\t</span>\n\t\t\t</span>\n"+(null!=(i=c(l,"if").call(s,null!=t?c(t,"showAdminTab"):t,{name:"if",hash:{},fn:n.program(7,e,0),inverse:n.noop,data:e,loc:{start:{line:18,column:3},end:{line:23,column:10}}}))?i:"")+'\t\t</div>\n\t\t<div class="actions">\n\t\t\t<a class="action settings-link" href="/account/email">\n\t\t\t\t<svg class="icon"><use xlink:href="#icon-settings"></use></svg>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\n\t<div class="list-container">\n\t\t<a role="button" class="load-top-button hidden">'+r((c(l,"intlMessage")||t&&c(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"feed.SHOW_NEWER_ITEMS"},data:e,loc:{start:{line:33,column:50},end:{line:33,column:98}}}))+'</a>\n\t</div>\n\t<div class=\'footer\'>\n\t\t<a class="foot-link" href="/notifications">\n\t\t\t'+r((c(l,"intlMessage")||t&&c(t,"intlMessage")||o).call(s,{name:"intlMessage",hash:{intlName:"notifications.VIEW_ALL_NOTIFICATIONS"},data:e,loc:{start:{line:38,column:3},end:{line:38,column:67}}}))+"\n\t\t</a>\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(a[t]=l)})),n.Template.register("hermes/notifications-panel",(function(t,e){return(e=e||{}).partials=e.partials?n.merge(a,e.partials):a,l(t,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("template-lib-helper",(function(e,t){var n=require("hermes-core/flog")(t);e.TemplateLibraryHelper=function(t,r){var l=r&&r.localizeLib?r.localizeLib:e.mix({langBundles:["common"]},e.Localizable),s={getTemplate:function(r,s){var i,o,a=e.Template.get("hermes/"+r),p=l.getLangBundles();if(p.locales=t.lang||l.defaultLang,"function"!=typeof a)throw n.error("Template not found",{topic:this.name,template:r}),new Error("Template not found: "+r);return t.flipper&&(i=t.flipper),t.segments&&(o=t.segments.segments),function(e){return!(e=e||{}).flippers&&i&&(e.flippers=i.toJSON()),!e.segments&&o&&(e.segments=o),s&&(e.isMobile=s.isMobile,e.cspNonce=s.cspNonce),a(e,{data:{intl:p,flippers:e.flippers,segments:e.segments}})}}};return e.augment(s,e.EventTarget),s}}),"@VERSION@",{requires:["event-custom"],optionalRequires:["hermes-core"]});YUI.add("hermes-template-join-group-invite-form",(function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,n,r){var i=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="send-invitation">\n\t<p>'+e.escapeExpression((i(t,"intlMessage")||a&&i(a,"intlMessage")||e.hooks.helperMissing).call(null!=a?a:e.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.GROUP_INVITE_ONLY_DESC"},data:r,loc:{start:{line:2,column:4},end:{line:2,column:60}}}))+'</p>\n\t<textarea class="group-invite-form"></textarea>\n</div>\n'},useData:!0}),n={};e.Array.each([],(function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)})),e.Template.register("hermes/join-group-invite-form",(function(a,r){return(r=r||{}).partials=r.partials?e.merge(n,r.partials):n,t(a,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("group-status-helper",(function(e,t){require("hermes-core/flog")(t);var n=e.mix({langBundles:["common","groups"]},e.Localizable);e.GroupStatusHelper=function(t,i){var o,r,s=i.groupId,a=i.view,u=new e.TemplateLibraryHelper(t,{localizeLib:n}),l={load:function(){var n=this;return YUI.Env.isServer||a.registerEventHandler(e.on("groupStatusHelper:groupStatusChanged",(function(e){e.groupId===s&&n.update()}))),i.useSearchModel?t.getModel("search-group-models",s).then((function(e){r=e,n.convertGroupInfoModel(e),n.groupRemoteMethods={join:e.registry.remote.join,leave:e.registry.remote.leave}})):t.getModel("group-info-models",s).then((function(e){return r=e,n.convertGroupInfoModel(e),n.groupRemoteMethods={join:e.registry.remote.join,leave:e.registry.remote.leave},e}))},initiateJoinGroup:function(){var i=this,r=this.getJoinStatus(),s=o.title,a=o.id;if(r.canJoin&&!r.signedIn)return this.showSignUpModal(a);if(r.canJoin&&!r.requiresRequest)return this.joinGroup(a);if(r.canJoin&&r.isInvited)return this.joinGroup(a);if(!r.hasJoined&&r.hasRequested&&r.requiresRequest){new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_HEADER",groupName:e.flutil.unescape(s)}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_INVITE_PENDING",groupName:s}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show();return e.Promise.resolve()}return r.hasJoined||r.hasRequested||!r.requiresRequest?r.hasJoined?(this.fire("groupJoined"),e.fire("groupStatusHelper:groupJoined",{groupId:a}),e.Promise.resolve()):void 0:this.promptForRules().then(e.bind((function(){this.showInviteRequestModal.call(this,a)}),this),e.bind((function(){i.fire("joinCanceled")}),this))},initiateLeaveGroup:function(){this.showLeaveGroupModal()},showLeaveGroupModal:function(){var i=this,r=o.title,s=o.id,u=null,l="";1===o.memberCount&&o.isMember?l=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_LAST_MEMBER",title:r}):o.isAdmin?(l=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_ADMIN",title:r}),l+=n.intlHTMLMessage({intlName:"groups.GROUPS_LEAVE_WARNING_REMOVE_PHOTOS"})):(l=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING",title:r}),l+=n.intlHTMLMessage({intlName:"groups.GROUPS_LEAVE_WARNING_REMOVE_PHOTOS"})),u=new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_TITLE",title:e.flutil.unescape(r)}),htmlMessage:l,actionButtonLabel:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_LEAVE_BUTTON"}),cancelButtonLabel:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_CANCEL_BUTTON"}),onConfirm:async(e,t)=>{let n=t.get("container").one("input"),i=n&&n.getDOMNode().checked;t.setLoading(!0),this.leaveGroup(s,i),await new Promise((e=>{let t=this.on("groupLeft",(()=>{a.detachRegisteredEvent(t),e()}));a.registerEventHandler(t)}))}}),hasSubviewConfigRefactor:!0}).show(),a.registerEventHandler(u.on("close",(e=>{i.fire("leaveCanceled")})))},joinGroup:function(){var i=this;return this.promptForRules().then((()=>this.groupRemoteMethods.join({groupModel:r,acceptRules:!0},t).then((function(t){return i.convertGroupInfoModel(t),i.fire("groupJoined"),e.fire("groupStatusHelper:groupJoined",{groupId:s}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:s}),t}),(function(o){new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"common.OOPS"}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_JOIN_ERROR"}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show();i.fire("joinCanceled")}))),(e=>{i.fire("joinCanceled")}))},leaveGroup:function(i,o){var s=this;this.groupRemoteMethods.leave({groupModel:r,deletePhotos:!!o},t).then((function(t){return s.convertGroupInfoModel(t),s.fire("groupLeft"),e.fire("groupStatusHelper:groupLeft",{groupId:i}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:i}),t}),(function(i){let o=new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"common.OOPS"}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_LEAVE_ERROR"}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show();a.registerEventHandler(o.on("close",(function(){s.fire("leaveCanceled")})))}))},showSignUpModal:function(i){var s,u=e.url("/groups/")+i,l=n.intlMessage({intlName:"groups.SIGN_IN_BEFORE_JOIN_TITLE"}),g=n.intlMessage({intlName:"groups.SIGN_UP_AND_JOIN_MESSAGE",name:o.title});s=new e.Views.SignUpModal({appContext:t,signUpHeaderClass:"avatar group big",signUpHeaderImage:void 0!==r.getValue("group")?r.getValue("group").getValue("bestIconURL"):r.getValue("bestIconURL"),signUpTitle:l,signUpMessage:g,beaconPrefix:"join"}),a.registerEventHandler(s.on("signUpClick",(function(t){e.SigninHelper.signUpPendingJoinGroup({id:i},{postLoginUrl:u})}))),a.registerEventHandler(s.on("signInClick",(function(t){e.SigninHelper.addPendingJoinGroup({id:i},{postLoginUrl:u})}))),s.show()},promptForRules:function(){return new e.Promise(((i,r)=>{var s=o.secureRules,u=null;s?(u=new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_TITLE"}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_MESSAGE"})+"<br /><pre>"+s+"</pre>",confirmButtonText:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_ACCEPT"}),cancelButtonText:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_DECLINE"}),onConfirm:async(e,t)=>{t.setLoading(!0),setTimeout((()=>{i()}),500)}}),hasSubviewConfigRefactor:!0}).show(),a.registerEventHandler(u.on("close",(function(){setTimeout((()=>{r()}),500)})))):i()}))},showInviteRequestModal:function(r){var s,l=this,g=n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_SEND"}),p=n.intlMessage({intlName:"common.CANCEL"}),c=u.getTemplate("join-group-invite-form",i.viewParams);s=new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_HEADER",groupName:e.flutil.unescape(o.title)}),htmlMessage:c({groupName:o.title}),actionButtonLabel:g,cancelButtonLabel:p,overlayClassList:"over-droparound-under-modal"}),a.registerEventHandler(s.on("actionClick",(function(){var i=s.get("container").one(".group-invite-form");if(i){var u=i.get("value");if(u.length>0){var g={group_id:r,message:u,accept_rules:!0};t.callAPI("flickr.groups.joinRequest",g).then((function(t){e.config.win.location.reload()}),(function(i){var r="";r=i&&7===i.code?n.intlMessage({intlName:"groups.GROUP_INVITE_PENDING",groupName:e.Escape.html(o.title)}):"message"in i?i.message:n.intlMessage({intlName:"common.ERROR"});let s=new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"common.ERROR"}),htmlMessage:r,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show();a.registerEventHandler(s.on("close",(()=>{l.fire("joinCanceled")})))}))}else setTimeout((function(){let i=new e.Views.FluidModal({appContext:t,subview:new e.Views["confirmation-dialog-view"]({appContext:t,title:n.intlMessage({intlName:"common.ERROR"}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_INVITE_EMPTY_MESSAGE"}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show();a.registerEventHandler(i.on("close",(()=>{l.fire("joinCanceled")})))}),300)}}))),a.registerEventHandler(s.on("activated",(function(){var e=s.get("container"),t=e.one("textarea")||!1;e&&t&&t.focus()}))),a.registerEventHandler(s.on("cancelClick",(function(){l.fire("joinCanceled")}))),s.show()},getJoinStatus:function(){var e,n,i,r=t&&t.getViewer(),s=r&&r.signedIn;return e=o.isMember,i=o.isInvited,n=o.hasPendingRequestToJoin,{signedIn:s,canJoin:!e&&!n,hasJoined:e,hasRequested:n,isInvited:i,requiresRequest:2===o.privacy,isAdmin:o.isAdmin}},convertGroupInfoModel:function(e){var t=i.useSearchModel?e:e.getValue("group");o={title:t.getValue("title"),id:t.getValue("id"),memberCount:t.getValue("memberCount"),isMember:t.getValue("isMember"),isModerator:t.getValue("isModerator"),isAdmin:t.getValue("isAdmin"),privacy:t.getValue("privacy"),isInvited:e.getValue("isInvited"),hasPendingRequestToJoin:e.getValue("hasPendingRequestToJoin"),secureRules:e.getValue("secureRules"),muted:t.getValue("muted")}},getInfo:function(){return{groupAttrs:o,joinStatus:this.getJoinStatus()}},toggleNotificationsMute:function(n){var o=i.useSearchModel?r:r.getValue("group");return t.callAPI(n?"flickr.activity.muteObject":"flickr.activity.unmuteObject",{group_id:s}).then((function(t){o.setValue("muted",n),e.fire("groupStatusHelper:groupStatusChanged",{groupId:s})}))},toggleMuteGroup:function(t){var n={object_id:s,object_type:1,pref_type:"GroupBatch",pref_val:t?0:1};return this.insertUserPrefs(n).then((function(n){e.fire("groupStatusHelper:groupMuteToggled",{groupId:s,isMuted:t}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:s})}))},insertUserPrefs:function(e){return t.callAPI("flickr.feed.preferences.insertUserPreferences",e)},update:function(){this.convertGroupInfoModel(r)},declineInvite:function(){return r.declineInvite()}};return e.augment(l,e.EventTarget),l}}),"@VERSION@",{requires:["event-custom","template-lib-helper","flutil","hermes-template-join-group-invite-form","url"],optionalRequires:["hermes-core"],langBundles:["common","groups"]});