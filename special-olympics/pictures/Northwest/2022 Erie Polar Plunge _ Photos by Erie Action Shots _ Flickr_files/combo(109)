YUI.add("albums-list-route",(function(e){var t=require("hermes-core/type-validator"),a=50,s=100;function i(e){i.superclass.constructor.call(this,e)}e.Routes[this.name]=i,e.extend(i,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(i){var o,n,r,l=this,u={},m=i.params.nsid_or_path_alias,p=i.params&&i.params.set_id,d=p?s:25,g=this.getPageNumber(i),c=i.geo;return t.nsid(m)?u.id=m:u.pathAlias=m,n="/photos/"+m+"/albums/",o={page:s/d*(g-1)+1,perPage:d,withSetId:p},e.Promise.all([this.appContext.getModel("sets-models",u,o),this.appContext.getModel("person-models",u),this.appContext.getModel("person-contacts-count-models",u)]).then((function(u){var d=u[0],h=u[1],v=0;if(YUI.Env.isServer&&(v=Math.ceil(d.getValue("totalItems")/s),g>v&&o.page>1&&!isNaN(parseInt(i.params.page_number,10))))return e.Promise.resolve({redirect:n.replace(/page[0-9]+/,"")});if(p){var R=d.getValue("albumsList");if(-1===(r=R.getPageOf({id:p},a))||R.getNextIncompletePage(o)===r)return o.forceAPICall=!0,t.nsid(m)?o.id=m:o.pathAlias=m,R.getPage(o).then((function(e){return g=Math.ceil(R.getPageOf({id:p},a)*a/s),r=g,l.onRouteResolved(d,h,g,r,n,p,c)}),(function(t){return e.Promise.resolve({redirect:n})}));g=Math.ceil(r*a/s),r=g}else r=2*(g-1)+1;return l.onRouteResolved(d,h,g,r,n,p,c)}),(function(t){return t&&p?e.Promise.resolve({redirect:n}):t.timeout?l.appContext.getModel("person-models",u).then((function(t){var a=t.getValue("displayname"),s={view:"empty-page-view",title:l.intlMessage({intlName:"common.USERS_ALBUMS",who:a}),params:{isSlow:!0,page:"albums",displayName:a,nsid:t.getValue("nsid")}};return e.Promise.resolve(s)}),(function(){return l.onRouteRejected(t,i)})):l.onRouteRejected(t,i)}))},onRouteResolved:function(t,i,o,n,r,l,u){var m,p=t.getValue("totalItems"),d=i.getValue("displayname");return m=0===parseInt(p,10)?{view:"empty-page-view",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:d}),params:{displayName:d,nsid:i.getValue("nsid"),page:"albums",geo:u}}:{view:"albums-list-page-view",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:d}),params:{nsid:t.id,withSetId:l,pageParams:{page:n,perPage:l?s:a,viewPageSize:s,nominalPage:o},geo:u,baseURL:r}},e.Promise.resolve(m)},onRouteRejected:function(t,a){if(t.fatal)throw t;return this.displayRouteErrors(a,new e.RouteError(404,this.intlMessage({intlName:"common.404_PERSON_NONEXISTENT"})))}}),e.mix(i.prototype,e.Localizable)}),"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models"],langBundles:["common"]});